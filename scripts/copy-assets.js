var cpr = require('cpr'),
    fs = require('fs'),
    path = require('path'),
    files = [
        ['../resources/images/logo_nobadge.png', '../app/assets/favicon.png'],
        ['../resources/images/logo.png', '../app/assets/logo.png'],
        ['../LICENSE', '../app/LICENSE'],
        ['../src/python/', '../app/server/python/'],
        ['../resources/fonts/', '../app/assets/fonts/'],
        ['../src/html/launcher.html', '../app/launcher/index.html'],
        ['../node_modules/fsevents/fsevents.node', '../app/server/fsevents.node'],
        ['../node_modules/ace-builds/src-min/worker-css.js', '../app/client/workers/worker-css.js'],
        ['../node_modules/ace-builds/src-min/worker-html.js', '../app/client/workers/worker-html.js'],
        ['../node_modules/ace-builds/src-min/worker-javascript.js', '../app/client/workers/worker-javascript.js'],
    ]

for (var i in files) {
    cpr(...files[i].map(f => path.resolve(__dirname + '/' + f)),Â {
        overwrite: true
    })
}


var packageJson = require('../package.json'),
    appJson = {},
    copiedProps = [
        "name",
        "productName",
        "description",
        "version",
        "author",
        "repository",
        "homepage",
        "license",
        "yargs",
        "engines"
    ]

for (var k of copiedProps) {
    appJson[k] = packageJson[k]
}

appJson.main = appJson.bin = "index.js"
appJson.scripts = {
  "start": "electron index.js",
  "start-node": "node index.js"
}

appJson.optionalDependencies = {
    electron: packageJson.optionalDependencies.electron
}

fs.writeFileSync(path.resolve(__dirname + '/../app/package.json'), JSON.stringify(appJson, null, '  '))

var clientHtml = fs.readFileSync(path.resolve(__dirname + '/../src/html/client.html'))
    .toString()
    .replace(/\$\{([^\}]+)\}/g, (m, p1)=>{return appJson[p1]})

fs.writeFileSync(path.resolve(__dirname + '/../app/client/index.html'), clientHtml)
